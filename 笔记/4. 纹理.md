# 纹理

## 简介

- 什么是纹理？

  纹理是一个2D图片（甚至也有1D和3D的纹理），它可以用来添加物体的细节；你可以想象纹理是一张绘有砖块的纸，无缝折叠贴合到你的3D的房子上，这样你的房子看起来就像有砖墙外表了。因为我们可以在一张图片上插入非常多的细节，这样就可以让物体非常精细而不用指定额外的顶点。 

- 纹理的作用

  - 给图形增加更多细节
  - 纹理也可以被用来储存大量的数据，这些数据可以发送到着色器上 

## 纹理相关概念

- 纹理环绕方式

  |      环绕方式      |                             描述                             |
  | :----------------: | :----------------------------------------------------------: |
  |     GL_REPEAT      |               对纹理的默认行为。重复纹理图像。               |
  | GL_MIRRORED_REPEAT |        和GL_REPEAT一样，但每次重复图片是镜像放置的。         |
  |  GL_CLAMP_TO_EDGE  | 纹理坐标会被约束在0到1之间，超出的部分会重复纹理坐标的边缘，产生一种边缘被拉伸的效果 |
  | GL_CLAMP_TO_BORDER |                超出的坐标为用户指定的边缘颜色                |

  操作函数：

  ```
  glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_MIRRORED_REPEAT);
  glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_MIRRORED_REPEAT);
  //第一个参数指定坐标（2D或者3D），第二个参数需要我们指定设置的选项与应用的纹理轴。我们打算配置的是WRAP选项，并且指定S和T轴，第三个参数指定环绕方式
  ```

  特别的，当我们用最后一种环绕方式时我们需要定义一个颜色数组来指定我们边缘颜色，类似于这样：

  ```
  float borderColor[] = { 1.0f, 1.0f, 0.0f, 1.0f };
  glTexParameterfv(GL_TEXTURE_2D, GL_TEXTURE_BORDER_COLOR, borderColor);
  ```

  

- 纹理过滤

  - 纹理坐标与纹理像素

  ​        纹理坐标指的是你给模型顶点设置的那个数组，是一组精确的值，OpenGL以这个顶点的纹理坐标数据去查找纹理图像上的 像素，然后进行采样提取纹理像素的颜色 。而纹理像素即将图片放大你看到的各个像素点

  - 过滤的目的

  ​        过滤的目的在与平衡纹理坐标与纹理像素的选取问题，即如何提取坐标点的像素颜色

  - 过滤的方法

  |          参数          |                             作用                             |
  | :--------------------: | :----------------------------------------------------------: |
  | GL_NEAREST（邻近过滤） |          OpenGL会选择中心点最接近纹理坐标的那个像素          |
  | GL_LINEAR （线性过滤） | 它会基于纹理坐标附近的纹理像素，计算出一个插值，近似出这些纹理像素之间的颜色。一个纹理像素的中心距离纹理坐标越近，那么这个纹理像素的颜色对最终的样本颜色的贡献越大 |

  - 使用场景

​       当进行放大(Magnify)和缩小(Minify)操作的时候可以设置纹理过滤的选项，比如你可以在纹理被缩小的时候使     用邻近过滤，被放大时使用线性过滤。我们需要使用glTexParameter*函数为放大和缩小指定过滤方式。这段代码看起来会和纹理环绕方式的设置很相似： 

```c++
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
```

- 多级渐远纹理

  - 应用场景

    想象一下，假设我们有一个包含着上千物体的大房间，每个物体上都有纹理。有些物体会很远，但其纹理会拥有与近处物体同样高的分辨率。由于远处的物体可能只产生很少的片段，OpenGL从高分辨率纹理中为这些片段获取正确的颜色值就很困难，因为它需要对一个跨过纹理很大部分的片段只拾取一个纹理颜色。当物体从远处拉回进处的过程当中在小物体上这会产生不真实的感觉（从模糊到突然清晰），更不用说对它们使用高分辨率纹理浪费内存的问题了。 

  - 整体思路

     对于距离不同的物体采用不同的纹理过滤方法，如何有效灵活的采用过滤方法成为glGenerateMipmaps函数 主要功能；与普通地问了过滤一样，多级渐远纹理也有自己独特的过滤方式，主要是应对不同的多级渐远纹理过滤方式切换时带来的不真实的感觉；切换多级渐远纹理级别时你也可以在两个不同多级渐远纹理级别之间使用NEAREST和LINEAR过滤。为了指定不同多级渐远纹理级别之间的过滤方式，你可以使用下面四个选项中的一个代替原有的过滤方式： 

  |         过滤方式          |                             描述                             |
  | :-----------------------: | :----------------------------------------------------------: |
  | GL_NEAREST_MIPMAP_NEAREST | 使用最邻近的多级渐远纹理来匹配像素大小，并使用邻近插值进行纹理采样 |
  | GL_LINEAR_MIPMAP_NEAREST  |     使用最邻近的多级渐远纹理级别，并使用线性插值进行采样     |
  | GL_NEAREST_MIPMAP_LINEAR  | 在两个最匹配像素大小的多级渐远纹理之间进行线性插值，使用邻近插值进行采样 |
  |  GL_LINEAR_MIPMAP_LINEAR  | 在两个邻近的多级渐远纹理之间使用线性插值，并使用线性插值进行采样 |

  就像纹理过滤一样，我们可以使用glTexParameteri将过滤方式设置为前面四种提到的方法之一： 

  ```c++
  glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);
  glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);纹理的使用
  ```

  

## 纹理的使用

- 导入头文件：stb_image.h   来加载纹理

  ```c++
  #define STB_IMAGE_IMPLEMENTATION
  #include"stb_image.h"
  ```

- 生成纹理
- 应用纹理